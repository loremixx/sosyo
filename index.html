<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye Sosyoloji Tarihi | Dijital Ağ Haritası</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>

    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --border: rgba(255,255,255,0.08);
            --muted: #94a3b8;
            --text-main: #f1f5f9;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
        }

        * { box-sizing: border-box; }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            overflow: hidden; /* Mobilde kaymayı önler */
        }

        .app {
            display: grid;
            grid-template-columns: 1fr 360px; /* Harita geniş, panel sabit */
            height: 100vh;
        }

        /* Harita Alanı */
        .map-container {
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            overflow: hidden;
        }

        #cy {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Sağ Panel */
        .panel {
            background: var(--panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            z-index: 10;
        }

        h1 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 4px 0;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        /* Arama & Filtreler */
        .controls { margin-bottom: 20px; }
        
        input[type=text] {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.2);
            color: inherit;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }
        input[type=text]:focus { border-color: var(--accent); }

        .filters {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .filter-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .filter-row:hover { color: white; }

        input[type=checkbox] { accent-color: var(--accent); }

        /* Bilgi Kartı */
        .node-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: auto; /* Panelin üst kısmına iter */
            transition: all 0.3s ease;
        }

        #card-title { font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 4px; }
        #card-meta { font-size: 12px; color: var(--accent); margin-bottom: 10px; font-weight: 500; }
        #card-body { font-size: 14px; line-height: 1.5; color: #cbd5e1; }

        /* Efsane (Legend) & Footer */
        .legend {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .legend-items { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
        .l-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--muted); }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        .actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            border: 0;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #334155; color: #e2e8f0; }
        .btn:hover { opacity: 0.9; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app { grid-template-columns: 1fr; grid-template-rows: 1fr auto; }
            .panel { height: 40vh; border-left: 0; border-top: 1px solid var(--border); }
            .map-container { height: 60vh; }
        }
    </style>
</head>
<body>

<div class="app">
    <div class="map-container">
        <div id="cy"></div>
    </div>

    <div class="panel">
        <h1>Sosyoloji Hafızası</h1>
        <div class="subtitle">Türkiye Sosyoloji Tarihi Etkileşimli Haritası</div>

        <div class="controls">
            <input id="search" type="text" placeholder="Kişi, Ekol veya Kurum ara..." autocomplete="off" />
        </div>

        <div class="filters">
            <div class="filter-title">Görünüm Filtreleri</div>
            <div class="filter-row"><label><input type="checkbox" class="theme-checkbox" value="Modernleşme" checked /> Modernleşme & Batılılaşma</label></div>
            <div class="filter-row"><label><input type="checkbox" class="theme-checkbox" value="Din" checked /> Din ve Toplum</label></div>
            <div class="filter-row"><label><input type="checkbox" class="theme-checkbox" value="Yapı" checked /> Toplumsal Yapı & Sınıf</label></div>
            <div class="filter-row"><label><input type="checkbox" class="theme-checkbox" value="Metod" checked /> Metodoloji & Ekoller</label></div>
        </div>

        <div id="card" class="node-card">
            <div id="card-title">Bir düğüme tıklayın</div>
            <div id="card-meta">Detaylar burada görünecek</div>
            <div id="card-body">Haritadaki kişiler (yuvarlak) ve temalar (kare) arasındaki ilişkileri keşfetmek için üzerlerine tıklayın.</div>
        </div>

        <div class="legend">
            <div class="filter-title">Renk Kodları</div>
            <div class="legend-items">
                <div class="l-item"><span class="dot" style="background:#ef4444"></span>Modernleşme</div>
                <div class="l-item"><span class="dot" style="background:#f59e0b"></span>Din</div>
                <div class="l-item"><span class="dot" style="background:#10b981"></span>Yapı/Sınıf</div>
                <div class="l-item"><span class="dot" style="background:#8b5cf6"></span>Metod/Ekol</div>
                <div class="l-item"><span class="dot" style="background:#64748b"></span>Kurum</div>
            </div>
        </div>

        <div class="actions">
            <button id="resetBtn" class="btn btn-secondary">Görünümü Sıfırla</button>
            <button id="exportBtn" class="btn btn-primary">Veriyi İndir</button>
        </div>
    </div>
</div>

<script>
// --- VERİ SETİ (Genişletilmiş ve Zenginleştirilmiş) ---
const DATA = {
    nodes: [
        // --- ÖNCÜLER ---
        { id: 'ziyag', label: 'Ziya Gökalp', type: 'Kişi', year: '1876–1924', themes:['Metod','Modernleşme'], bio: 'Türk sosyolojisinin kurucusu. Durkheimcı ekolü Türkiye\'ye taşıdı. "Türkleşmek, İslamlaşmak, Muasırlaşmak" formülüyle bilinir.' },
        { id: 'psabahattin', label: 'Prens Sabahattin', type: 'Kişi', year: '1879–1948', themes:['Yapı','Metod'], bio: 'Le Play ekolü temsilcisi. "Adem-i Merkeziyet" ve "Teşebbüs-ü Şahsi" fikirleriyle liberal sosyolojinin öncüsü.' },
        
        // --- CUMHURİYET DÖNEMİ & İLK AKADEMİSYENLER ---
        { id: 'hzu', label: 'Hilmi Ziya Ülken', type: 'Kişi', year:'1901–1974', themes:['Metod','Modernleşme'], bio:'Türk düşünce tarihinin en üretken ismi. Felsefe ve sosyolojiyi sentezledi. "Aşk Ahlakı" ve "Türkiye\'de Çağdaş Düşünce Tarihi" eserleri temeldir.'},
        { id: 'berkes', label: 'Niyazi Berkes', type: 'Kişi', year:'1908–1988', themes:['Modernleşme','Din'], bio:'"Türkiye\'de Çağdaşlaşma" eseriyle tanınır. Laiklik ve tarihsel gelişim üzerine seküler bir perspektif sundu.'},
        { id: 'boran', label: 'Behice Boran', type: 'Kişi', year:'1910–1987', themes:['Yapı'], bio:'Marksist sosyolog. Saha çalışmasına dayalı toplumsal yapı analizleri yaptı (Manisa köyleri). TİP genel başkanlığı yaptı.'},
        { id: 'fin', label: 'Z.F. Fındıkoğlu', type: 'Kişi', year:'1899–1974', themes:['Metod'], bio:'İstanbul Üniversitesi\'nde uzun yıllar hocalık yaptı. Folklor ve hukuk sosyolojisi üzerine çalıştı.'},

        // --- MODERN DÖNEM & ELEŞTİREL YAKLAŞIMLAR ---
        { id: 'mardin', label: 'Şerif Mardin', type: 'Kişi', year:'1927–2017', themes:['Din','Modernleşme'], bio:'"Merkez-Çevre" kuramı. Türk modernleşmesinin dinamiğini ve dinin toplumsal rolünü Weberci bir perspektifle inceledi.'},
        { id: 'kiray', label: 'Mübeccel Kıray', type: 'Kişi', year:'1923–2007', themes:['Yapı'], bio:'"Tampon Kurumlar" teorisi. Ereğli ağır sanayi araştırması ile hızlı toplumsal değişimi ve kentleşmeyi inceledi.'},
        { id: 'kucukomer', label: 'İdris Küçükömer', type: 'Kişi', year:'1925–1987', themes:['Modernleşme','Yapı'], bio:'"Düzenin Yabancılaşması". Türkiye\'deki sağ ve sol kavramlarını tersyüz eden sivil toplumcu eleştiriler getirdi.'},
        { id: 'kongar', label: 'Emre Kongar', type: 'Kişi', year:'1941–', themes:['Yapı','Modernleşme'], bio:'Toplumsal değişme kuramları üzerine çalışmalarıyla bilinir. Popüler sosyolojinin önemli ismi.'},
        { id: 'gole', label: 'Nilüfer Göle', type: 'Kişi', year:'1953–', themes:['Modernleşme','Din'], bio:'"Modern Mahrem". İslami hareketler, kamusal alan ve modernleşme eleştirileri üzerine çalışıyor.'},
        { id: 'keyder', label: 'Çağlar Keyder', type: 'Kişi', year:'1947–', themes:['Yapı'], bio:'Dünya sistemleri teorisi bağlamında Türkiye\'nin ekonomi politiği ve devlet inşası.'},

        // --- KURUMLAR ---
        { id: 'iu_sos', label: 'İÜ Sosyoloji', type: 'Kurum', year:'1914–', themes:[], bio:'Türkiye\'de sosyolojinin kurumsallaştığı ilk yer (Darülfünun).'},
        { id: 'dtcf', label: 'Ankara DTCF', type: 'Kurum', year:'1935–', themes:[], bio:'Cumhuriyet ideolojisi ve antropoloji/etnoloji çalışmalarıyla bütünleşik gelişti.'},
        { id: 'odtu', label: 'ODTÜ Sosyoloji', type: 'Kurum', year:'1960s–', themes:[], bio:'Daha ampirik, İngilizce eğitim veren ve eleştirel sosyal bilimler geleneği.'},

        // --- TEMALAR (HUB NODES) ---
        { id: 't_modern', label: 'Modernleşme', type: 'Tema', themes:['Modernleşme'], bio:'Batılılaşma, Sekülerizm ve Devlet İnşası tartışmaları.'},
        { id: 't_din', label: 'Din Sosyolojisi', type: 'Tema', themes:['Din'], bio:'İslamcılık, Tarikatlar, Laiklik ve Alevilik çalışmaları.'},
        { id: 't_yapi', label: 'Toplumsal Yapı', type: 'Tema', themes:['Yapı'], bio:'Sınıf, Kentleşme, Göç ve Ekonomi Politik.'},
        { id: 't_metod', label: 'Ekol & Teori', type: 'Tema', themes:['Metod'], bio:'Durkheimcılık, Le Play, Marksizm ve Weberci analizler.'},
    ],
    edges: [
        // Ziya Gökalp Bağlantıları
        { source: 'ziyag', target: 't_metod', rel: 'Solidarizm' },
        { source: 'ziyag', target: 't_modern', rel: 'Ulus Devlet' },
        { source: 'ziyag', target: 'iu_sos', rel: 'Kurucu' },

        // Prens Sabahattin
        { source: 'psabahattin', target: 't_metod', rel: 'Le Play Ekolü' },
        { source: 'psabahattin', target: 'ziyag', rel: 'Fikri Rakip', weight: 1 }, // Çatışma

        // Hilmi Ziya
        { source: 'hzu', target: 'iu_sos', rel: 'Hoca' },
        { source: 'hzu', target: 'ziyag', rel: 'Etkilendi' },

        // DTCF Grubu
        { source: 'boran', target: 'dtcf', rel: 'Akademisyen' },
        { source: 'berkes', target: 'dtcf', rel: 'Akademisyen' },
        { source: 'boran', target: 't_yapi', rel: 'Sınıf Analizi' },
        { source: 'berkes', target: 't_modern', rel: 'Çağdaşlaşma' },

        // Şerif Mardin
        { source: 'mardin', target: 't_din', rel: 'Din Sosyolojisi' },
        { source: 'mardin', target: 't_modern', rel: 'Merkez-Çevre' },
        { source: 'mardin', target: 'berkes', rel: 'Eleştirel Diyalog' },

        // Mübeccel Kıray
        { source: 'kiray', target: 't_yapi', rel: 'Tampon Kurumlar' },
        { source: 'kiray', target: 'odtu', rel: 'Hoca' },

        // Nilüfer Göle
        { source: 'gole', target: 'mardin', rel: 'Öğrenci/Etki' },
        { source: 'gole', target: 't_din', rel: 'Modern Mahrem' },

        // Diğerleri
        { source: 'kucukomer', target: 't_modern', rel: 'Sivil Toplum' },
        { source: 'keyder', target: 't_yapi', rel: 'Dünya Sistemi' },
        { source: 'fin', target: 'iu_sos', rel: 'Hoca' },
        
        // Tema Bağlantıları (Görsel bütünlük için)
        { source: 't_modern', target: 't_din', rel: 'Kesişim', weight: 0.5 },
    ]
};

// --- CYTOSCAPE JS YAPILANDIRMASI ---

const cy = cytoscape({
    container: document.getElementById('cy'),
    elements: [
        ...DATA.nodes.map(n => ({ data: { ...n, weight: n.type === 'Tema' ? 60 : (n.type === 'Kurum' ? 40 : 25) } })),
        ...DATA.edges.map((e, i) => ({ data: { id: 'e'+i, source: e.source, target: e.target, weight: e.weight || 2 } }))
    ],
    style: [
        {
            selector: 'node',
            style: {
                'label': 'data(label)',
                'color': '#f1f5f9',
                'font-size': '11px',
                'text-valign': 'bottom',
                'text-halign': 'center',
                'text-margin-y': 6,
                'text-outline-width': 2,
                'text-outline-color': '#0f172a',
                'width': 'data(weight)',
                'height': 'data(weight)',
                'border-width': 2,
                'border-color': '#1e293b',
                'background-color': function(ele){
                    const themes = ele.data('themes') || [];
                    const type = ele.data('type');
                    if(type === 'Kurum') return '#64748b';
                    if(themes.includes('Modernleşme')) return '#ef4444';
                    if(themes.includes('Din')) return '#f59e0b';
                    if(themes.includes('Yapı')) return '#10b981';
                    if(themes.includes('Metod')) return '#8b5cf6';
                    return '#94a3b8';
                }
            }
        },
        {
            selector: 'node[type="Tema"]',
            style: {
                'shape': 'round-rectangle',
                'text-valign': 'center',
                'color': '#fff',
                'font-weight': 'bold',
                'text-outline-width': 0,
                'font-size': '12px',
                'opacity': 0.9
            }
        },
        {
            selector: 'edge',
            style: {
                'width': 1.5,
                'curve-style': 'bezier',
                'line-color': '#334155',
                'target-arrow-color': '#334155',
                'target-arrow-shape': 'triangle',
                'arrow-scale': 0.8,
                'opacity': 0.6
            }
        },
        {
            selector: ':selected',
            style: {
                'border-width': 3,
                'border-color': '#fff',
                'line-color': '#6366f1',
                'target-arrow-color': '#6366f1',
                'source-arrow-color': '#6366f1',
                'opacity': 1
            }
        }
    ],
    layout: {
        name: 'cose', // Fizik tabanlı yerleşim
        idealEdgeLength: 100,
        nodeOverlap: 20,
        refresh: 20,
        fit: true,
        padding: 30,
        randomize: false,
        componentSpacing: 100,
        nodeRepulsion: 4000,
        edgeElasticity: 100,
        nestingFactor: 5,
        gravity: 80,
        numIter: 1000,
        initialTemp: 200,
        coolingFactor: 0.95,
        minTemp: 1.0
    }
});

// --- ETKİLEŞİM FONKSİYONLARI ---

// Düğüme Tıklama
cy.on('tap', 'node', function(evt){
    const node = evt.target;
    const d = node.data();
    
    // Kartı Güncelle
    document.getElementById('card-title').textContent = d.label;
    document.getElementById('card-meta').innerHTML = 
        `<span style="color:var(--muted)">${d.year}</span> <br/>` + 
        `<span style="color:var(--accent)">${d.type}</span>` + 
        (d.themes && d.themes.length ? ` • ${d.themes.join(', ')}` : '');
    document.getElementById('card-body').textContent = d.bio || 'Bu kayıt için detaylı bilgi henüz eklenmedi.';

    // Vurgula (Highlight)
    cy.elements().removeClass('faded');
    const connected = node.neighborhood().add(node);
    cy.elements().difference(connected).style('opacity', 0.1);
    connected.style('opacity', 1);
});

// Boşluğa Tıklama (Reset)
cy.on('tap', function(evt){
    if(evt.target === cy){
        resetCard();
        cy.elements().style('opacity', 1);
    }
});

function resetCard(){
    document.getElementById('card-title').textContent = 'Bir düğüme tıklayın';
    document.getElementById('card-meta').textContent = 'Detaylar burada görünecek';
    document.getElementById('card-body').textContent = 'Haritadaki kişiler ve temalar arasındaki ilişkileri keşfetmek için üzerlerine tıklayın.';
}

// Arama Fonksiyonu
document.getElementById('search').addEventListener('input', function(e){
    const val = e.target.value.toLowerCase();
    if(!val){
        cy.elements().style('display', 'element');
        return;
    }
    
    cy.batch(() => {
        cy.nodes().forEach(n => {
            const label = n.data('label').toLowerCase();
            if(label.includes(val)){
                n.style('display', 'element');
            } else {
                n.style('display', 'none');
            }
        });
    });
});

// Filtreler
const checkboxes = document.querySelectorAll('.theme-checkbox');
function applyFilters(){
    const activeThemes = Array.from(checkboxes).filter(c => c.checked).map(c => c.value);
    
    cy.batch(() => {
        cy.nodes().forEach(n => {
            const nThemes = n.data('themes') || [];
            const type = n.data('type');
            
            // Kurumları ve Temaları her zaman göster, kişileri filtreye göre göster
            let shouldShow = false;
            if(type === 'Kurum' || type === 'Tema') shouldShow = true;
            else if(nThemes.some(t => activeThemes.includes(t))) shouldShow = true;
            
            n.style('display', shouldShow ? 'element' : 'none');
        });
    });
}
checkboxes.forEach(cb => cb.addEventListener('change', applyFilters));

// Reset Button
document.getElementById('resetBtn').addEventListener('click', function(){
    cy.layout({ name: 'cose', animate: true }).run();
    cy.fit();
    cy.elements().style('opacity', 1);
    document.getElementById('search').value = '';
    checkboxes.forEach(cb => cb.checked = true);
    applyFilters();
    resetCard();
});

// Export
document.getElementById('exportBtn').addEventListener('click', function(){
    const json = cy.json();
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(json));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "sosyoloji_ag_haritasi.json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
});

// İlk Yüklemede Ortalama
cy.ready(() => {
    cy.fit(30);
});

</script>
</body>
</html>
